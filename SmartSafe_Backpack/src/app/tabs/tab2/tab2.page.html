<ion-header [translucent]="true">
  <ion-toolbar class="custom-toolbar">
    <ion-title class="toolbar-title">LocalizaciÃ³n en Tiempo Real</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="presentPopover($event)">
        <ion-icon name="person-circle-outline" class="profile-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="map-container">
    
    <!-- ðŸ”¥ GPS Status Bar - ESTADOS DINÃMICOS -->
    <div class="gps-status-bar" 
         [class.status-inactive]="!isConnected"
         [class.status-searching]="isSearchingGPS">
      <div class="status-info">
        <div class="gps-indicator">
          <!-- ðŸ”¥ Iconos segÃºn estado -->
          <ion-icon 
            *ngIf="!isConnected" 
            name="navigate-circle-outline">
          </ion-icon>
          
          <ion-icon 
            *ngIf="isConnected && isSearchingGPS" 
            name="scan-circle-outline" 
            class="searching-icon">
          </ion-icon>
          
          <ion-icon 
            *ngIf="isConnected && hasGPSFix" 
            name="navigate-circle">
          </ion-icon>
          
          <!-- ðŸ”¥ Texto segÃºn estado -->
          <span *ngIf="!isConnected">ESP32 Desconectado</span>
          <span *ngIf="isConnected && isSearchingGPS">Buscando SatÃ©lites...</span>
          <span *ngIf="isConnected && hasGPSFix">GPS con FIX</span>
        </div>
        
        <!-- ðŸ”¥ Barras de seÃ±al solo si tiene FIX -->
        <div class="signal-strength" *ngIf="hasGPSFix">
          <div class="signal-bar" [class.active]="satellites >= 1"></div>
          <div class="signal-bar" [class.active]="satellites >= 3"></div>
          <div class="signal-bar" [class.active]="satellites >= 5"></div>
          <div class="signal-bar" [class.active]="satellites >= 7"></div>
        </div>
        
        <!-- ðŸ”¥ Spinner mientras busca satÃ©lites -->
        <div class="searching-spinner" *ngIf="isSearchingGPS">
          <div class="spinner-ring"></div>
        </div>
      </div>
      
      <!-- ðŸ”¥ Badge de satÃ©lites -->
      <div class="accuracy-badge" 
           [class.badge-inactive]="!isConnected"
           [class.badge-searching]="isSearchingGPS">
        <ion-icon name="radio-outline"></ion-icon>
        <span>{{ satellites }} SAT</span>
      </div>
    </div>

    <!-- Mapa de Google Maps -->
    <div class="map-area">
      <div id="map"></div>
      
      <!-- ðŸ”¥ Overlay de estado de bÃºsqueda -->
      <div class="map-overlay" *ngIf="isSearchingGPS">
        <div class="overlay-content">
          <div class="pulse-circle"></div>
          <ion-icon name="satellite-outline" class="satellite-icon"></ion-icon>
          <p class="overlay-text">Buscando seÃ±al GPS...</p>
          <p class="overlay-subtext">{{ satellites }} satÃ©lite(s) detectado(s)</p>
        </div>
      </div>
    </div>

    <!-- ðŸ”¥ Location Info Card - ESTADOS DINÃMICOS -->
    <div class="location-info-card" 
         [class.card-inactive]="!isConnected"
         [class.card-searching]="isSearchingGPS">
      <div class="card-header">
        <ion-icon 
          [name]="!isConnected ? 'location-outline' : (isSearchingGPS ? 'search-outline' : 'location')">
        </ion-icon>
        
        <h3>
          {{ !isConnected ? 'ESP32 Desconectado' : (isSearchingGPS ? 'Esperando FIX GPS' : 'UbicaciÃ³n Actual') }}
        </h3>
      </div>
      
      <div class="coordinates-grid">
        <div class="coordinate-item">
          <p class="label">Latitud</p>
          <p class="value" [class.value-inactive]="!hasGPSFix">
            {{ hasGPSFix ? (latitude | number:'1.6-6') + 'Â°' : '---.------Â°' }}
          </p>
        </div>
        <div class="coordinate-divider"></div>
        <div class="coordinate-item">
          <p class="label">Longitud</p>
          <p class="value" [class.value-inactive]="!hasGPSFix">
            {{ hasGPSFix ? (longitude | number:'1.6-6') + 'Â°' : '---.------Â°' }}
          </p>
        </div>
      </div>

      <!-- ðŸ”¥ Grid de datos adicionales -->
      <div class="data-grid">
        <div class="data-item">
          <ion-icon name="speedometer-outline"></ion-icon>
          <div class="data-content">
            <p class="data-label">Velocidad</p>
            <p class="data-value" [class.value-inactive]="!hasGPSFix">
              {{ hasGPSFix ? (speed | number:'1.0-0') + ' km/h' : '--- km/h' }}
            </p>
          </div>
        </div>
        
        <div class="data-item">
          <ion-icon name="analytics-outline"></ion-icon>
          <div class="data-content">
            <p class="data-label">Altitud</p>
            <p class="data-value" [class.value-inactive]="!hasGPSFix">
              {{ hasGPSFix ? (altitude | number:'1.0-0') + ' m' : '--- m' }}
            </p>
          </div>
        </div>
      </div>

      <div class="update-info">
        <ion-icon 
          [name]="!isConnected ? 'close-circle-outline' : (isSearchingGPS ? 'hourglass-outline' : 'time-outline')">
        </ion-icon>
        <span>{{ lastUpdateText }}</span>
        
        <!-- ðŸ”¥ Indicador EN VIVO solo con FIX -->
        <div class="live-indicator" *ngIf="isConnected && hasGPSFix">
          <div class="live-dot"></div>
          <span>EN VIVO</span>
        </div>
        
        <!-- ðŸ”¥ Indicador BUSCANDO -->
        <div class="searching-indicator" *ngIf="isSearchingGPS">
          <div class="searching-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
          <span>BUSCANDO</span>
        </div>
        
        <!-- ðŸ”¥ Indicador OFFLINE -->
        <div class="offline-indicator" *ngIf="!isConnected">
          <span>OFFLINE</span>
        </div>
      </div>
    </div>

  </div>
</ion-content>